<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>VIRTUAL LOT</title>

<link rel="stylesheet" href="css/leaflet.css">
<link rel="stylesheet" href="style.css">

</head>

<body>

<!-- HEADER -->
<div id="header">
    <img src="images/puo.png">
    <span>VIRTUAL LOT ‚Äì TAMAN PERUMAHAN</span>
</div>

<!-- TOGGLE BUTTON -->
<button id="toggleBtn" onclick="toggleSidebar()">‚ò∞</button>

<!-- SIDEBAR -->
<div id="sidebar">
    <button class="closeBtn" onclick="toggleSidebar()">‚úñ</button>

    <h3>üåç Land Explorer</h3>

    <input type="text" id="searchLot" placeholder="Cari No Lot">
    <button class="btn" onclick="searchLot()">üîç Search</button>
    <button class="btn reset" onclick="resetMap()">‚ôª Reset</button>

    <hr>

    <div class="info">
        <div class="box">
            <small>Total Lot</small>
            <span id="totalLots">0</span>
        </div>

        <div class="box">
            <small>Keluasan Lot</small>
            <span id="selectedArea">-</span>
        </div>
    </div>
</div>

<!-- MAP -->
<div id="map"></div>

<script src="js/leaflet.js"></script>
<script src="js/Leaflet.GoogleMutant.js"></script>
<script src="data/LOTFINAL_0.js"></script>

<script>
function toggleSidebar(){
    document.getElementById("sidebar").classList.toggle("active");
}

/* MAP INIT */
var map = L.map('map').fitBounds([
    [2.102821,102.520895],
    [2.104582,102.524810]
]);

/* BASE MAPS */
var googleSat = L.gridLayer.googleMutant({
    type: 'satellite'
}).addTo(map);

var googleStreet = L.gridLayer.googleMutant({
    type: 'roadmap'
});

var esri = L.tileLayer(
'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
);

/* LOT STYLE */
function styleLot(){
    return {
        color:"#1b5e20",
        weight:1,
        fillColor:"#66bb6a",
        fillOpacity:0.7
    };
}

/* LOT LAYER */
var lotLayer = L.geoJSON(json_LOTFINAL_0,{
    style:styleLot,
    onEachFeature:function(feature,layer){

        document.getElementById("totalLots").innerText =
        json_LOTFINAL_0.features.length;

        layer.bindPopup(
            "<b>No Lot:</b> "+feature.properties.NO_LOT+
            "<br><b>Keluasan:</b> "+feature.properties.AREA
        );

        layer.on("click",function(){
            document.getElementById("selectedArea").innerText =
            feature.properties.AREA;
        });
    }
}).addTo(map);

/* LAYER CONTROL */
var baseMaps = {
    "üõ∞ Google Satellite": googleSat,
    "üõ£ Google Street": googleStreet,
    "üåç Esri Satellite": esri
};

var overlayMaps = {
    "üìê Lot Tanah": lotLayer
};

L.control.layers(baseMaps, overlayMaps).addTo(map);

/* SEARCH LOT */
function searchLot(){
    var input = document.getElementById("searchLot").value.toLowerCase();

    lotLayer.eachLayer(function(layer){
        if(layer.feature.properties.NO_LOT.toLowerCase().includes(input)){
            map.fitBounds(layer.getBounds());
            layer.setStyle({fillColor:"#ffeb3b"});
        }
    });
}

/* RESET */
function resetMap(){
    document.getElementById("searchLot").value="";
    document.getElementById("selectedArea").innerText="-";

    lotLayer.eachLayer(function(layer){
        layer.setStyle(styleLot());
    });
}
</script>

</body>
</html>
