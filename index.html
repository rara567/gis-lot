<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>VIRTUAL LOT</title>

<link rel="stylesheet" href="css/leaflet.css">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- HEADER -->
<div id="header">
    <img src="images/puo.png" alt="Logo PUO">
    <span>üåø TAMAN PERUMAHAN</span>
</div>

<!-- TOGGLE BUTTON (LUAR SIDEBAR) -->
<div id="toggleBtn" onclick="toggleSidebar()">‚ò∞ Menu</div>

<!-- SIDEBAR -->
<div id="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">‚úñ Tutup Menu</button>

    <h3>üåç Land Explorer</h3>

    <input type="text" id="searchLot" placeholder="üîé Lot Number">
    <button onclick="searchLot()">Search</button>
    <button onclick="resetMap()">Reset Map</button>

    <hr>

    <div class="info">
        <p><b>Total Lots</b><br>
        <span id="totalLots">0</span></p>

        <p><b>Selected Area</b><br>
        <span id="selectedArea">-</span></p>
    </div>
</div>

<!-- MAP -->
<div id="map"></div>

<script src="js/leaflet.js"></script>
<script src="data/LOTFINAL_0.js"></script>
<script src="data/BKLMERGED_1.js"></script>

<script>
// ================= SIDEBAR TOGGLE =================
function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
}

// ================= MAP INIT =================
var map = L.map('map').fitBounds([
    [2.1028210898387267,102.5208953333649],
    [2.104582114972745,102.5248101292728]
]);

// ================= BASEMAP =================
var street = L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    { attribution: '&copy; OpenStreetMap contributors' }
).addTo(map);

var satellite = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { attribution: 'Tiles &copy; Esri' }
);

L.control.layers({
    "üó∫ Street": street,
    "üõ∞ Satellite": satellite
}).addTo(map);

// ================= STYLE =================
function styleLot() {
    return {
        color: "#1b5e20",
        weight: 1,
        fillColor: "#66bb6a",
        fillOpacity: 0.7
    };
}

// ================= STREET VIEW =================
function openStreetView(lat, lng) {
    window.open(
        "https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=" +
        lat + "," + lng,
        "_blank"
    );
}

// ================= LOT LAYER =================
var lotLayer = L.geoJSON(json_LOTFINAL_0, {
    style: styleLot,
    onEachFeature: function(feature, layer){

        document.getElementById("totalLots").innerText =
            json_LOTFINAL_0.features.length;

        var center = layer.getBounds().getCenter();

        var popup =
            "<b>Lot:</b> " + feature.properties.NO_LOT + "<br>" +
            "<b>Area:</b> " + feature.properties.AREA + "<br><br>" +
            "<button class='popup-btn' onclick='openStreetView(" +
            center.lat + "," + center.lng +
            ")'>üëÅ Street View</button>";

        layer.bindPopup(popup);

        layer.on("mouseover", function(){
            layer.setStyle({ fillColor:"#a5d6a7" });
        });

        layer.on("mouseout", function(){
            layer.setStyle(styleLot());
        });

        layer.on("click", function(){
            document.getElementById("selectedArea").innerText =
                feature.properties.AREA;
        });
    }
}).addTo(map);

// ================= SEARCH =================
function searchLot(){
    var input = document.getElementById("searchLot").value.toLowerCase();

    lotLayer.eachLayer(function(layer){
        if(layer.feature.properties.NO_LOT.toLowerCase().includes(input)){
            map.fitBounds(layer.getBounds());
            layer.setStyle({ fillColor:"#ffeb3b" });
        }
    });
}

// ================= RESET =================
function resetMap(){
    document.getElementById("searchLot").value="";
    document.getElementById("selectedArea").innerText="-";

    lotLayer.eachLayer(function(layer){
        layer.setStyle(styleLot());
    });

    map.fitBounds(lotLayer.getBounds());
}
</script>

</body>
</html>
